version: '3.8'

services:
  api-gateway:
    container_name: "api-gateway"
    hostname: "api-gateway"
    build: ../../api-gateway/target
    ports:
      - "8080:8080"
    expose:
      - "8080"
    networks:
      - backend

  service-calculator:
    container_name: "service-calculator"
    hostname: "service-calculator"
    build: ../../service-calculator/target
    ports:
      - "5555:5555"
    expose:
      - "5555"
    depends_on:
      - api-gateway
    networks:
      - backend

  service-database:
    container_name: "service-database"
    hostname: "service-database"
    build: ../../service-database/target
    ports:
      - "6666:6666"
    expose:
      - "6666"
    depends_on:
      - api-gateway
    networks:
      - backend

  service-history:
    container_name: "service-history"
    hostname: "service-history"
    build: ../../service-history/target
    ports:
      - "7777:7777"
    expose:
      - "7777"
    depends_on:
      - api-gateway
      - service-history-db
    links:
      - service-history-db
    networks:
      - backend

  service-history-db:
    container_name: "service-history-db"
    hostname: "service-history-db"
    image: "mongo:3.7"
    environment:
      - MONGO_DATA_DIR=/data/db
      - MONGO_LOG_DIR=/dev/null
    volumes:
      - mongodata:/data/db
    ports:
      - "8888:8888"
    expose:
      - "8888"
    command: mongod
    networks:
      - backend

networks:
  backend:
    driver: bridge

volumes:
  mongodata:
